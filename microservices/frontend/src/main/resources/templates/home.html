<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOps Playground UI</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body th:attr="data-api-base-url=${apiBaseUrl}">
    <div class="layout">
        <header>
            <h1>DevOps Playground UI</h1>
            <p class="subtitle">Spring Boot frontend placeholder</p>
        </header>
        <section class="status">
            <p><strong>Environment:</strong> <span th:text="${environment}"></span></p>
            <p><strong>Status:</strong> <span th:text="${message}"></span></p>
            <p><strong>Updated:</strong> <span th:text="${timestamp}"></span></p>
        </section>
        <section class="actions">
            <h2>Next Steps</h2>
            <ul>
                <li>Wire this UI to backend services.</li>
                <li>Surface contract test results.</li>
                <li>Display preview environment metadata.</li>
            </ul>
        </section>
        <section class="api">
            <h2>EU Countries & Currencies</h2>
            <p><strong>API status:</strong> <span id="api-status">idle</span></p>
            <p class="error hidden" id="api-error"></p>
            <button id="toggle-countries" type="button">Click this button to show all the countries</button>
            <div id="countries-panel" class="hidden"></div>
        </section>
    </div>
    <script>
        const toggleButton = document.getElementById("toggle-countries");
        const panel = document.getElementById("countries-panel");
        const statusEl = document.getElementById("api-status");
        const errorEl = document.getElementById("api-error");
        const apiBaseUrl = document.body.dataset.apiBaseUrl;
        let loaded = false;

        const renderTable = (countries) => {
            if (!countries.length) {
                panel.innerHTML = "<p>No currency data available yet.</p>";
                return;
            }

            const rows = countries.map((entry) => `
                <tr>
                    <td>${entry.country}</td>
                    <td>${entry.currencyName}</td>
                    <td>${entry.currencyCode}</td>
                </tr>
            `).join("");

            panel.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th>Currency</th>
                            <th>Code</th>
                        </tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>
            `;
        };

        const setError = (message) => {
            errorEl.textContent = message;
            errorEl.classList.remove("hidden");
        };

        toggleButton.addEventListener("click", async () => {
            if (loaded) {
                panel.classList.toggle("hidden");
                return;
            }

            statusEl.textContent = "loading";
            errorEl.classList.add("hidden");

            try {
                const response = await fetch(`${apiBaseUrl}/api/countries`);
                if (!response.ok) {
                    throw new Error(`API returned ${response.status}`);
                }
                const countries = await response.json();
                renderTable(countries);
                statusEl.textContent = "ok";
                panel.classList.remove("hidden");
                loaded = true;
            } catch (error) {
                statusEl.textContent = "error";
                setError(`API request failed: ${error.message}`);
            }
        });
    </script>
</body>
</html>
